<h1>uglify-save-license</h1><p><a href="http://badge.fury.io/js/uglify-save-license"><img src="https://badge.fury.io/js/uglify-save-license.svg" alt="NPM version"></a>
<a href="https://travis-ci.org/shinnn/uglify-save-license"><img src="https://travis-ci.org/shinnn/uglify-save-license.svg" alt="Build Status"></a>
<a href="https://david-dm.org/shinnn/uglify-save-license#info=devDependencies"><img src="https://david-dm.org/shinnn/uglify-save-license/dev-status.svg" alt="devDependency Status"></a></p>
<p>A support module for <a href="http://lisperator.net/uglifyjs/">UglifyJS</a> to detect and preserve license comments</p>
<pre><code class="language-javascript">//     Backbone.js 1.1.2

//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

(function(root, factory) {

  // Set up Backbone appropriately for the environment. Start with AMD.
  if (typeof define === &#39;function&#39; &amp;&amp; define.amd) {
    define([&#39;underscore&#39;, &#39;jquery&#39;, &#39;exports&#39;], function(_, $, exports) {
//...
</code></pre>
<p>â†“</p>
<pre><code class="language-javascript">//     Backbone.js 1.1.2
//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org
!function(a,b){if(&quot;function&quot;==typeof define&amp;&amp;define.amd)define([&quot;underscore&quot;,&quot;jquery&quot;,&quot;exports&quot;],function(c,d,e){a.Backbone=b(a,e,c,d)});else if(&quot;undefined&quot;!=typeof exports){...
</code></pre>
<h2>Overview</h2><p>This module enables us to preserve license comments when using UglifyJS.</p>
<p>Even if the license statement is in multiple line comments, or the comment has no directive such as <code>@license</code> and <code>/*!</code>, this module keeps them readable.</p>
<h2>Installation</h2><p>Install with <a href="https://npmjs.org/">npm</a>. (Make sure you have installed <a href="http://nodejs.org/download/">Node</a>.)</p>
<pre><code>npm install --save-dev uglify-save-license
</code></pre><h2>Usage</h2><p>First of all, load <code>uglify-save-license</code> module.</p>
<pre><code class="language-javascript">var saveLicense = require(&#39;uglify-save-license&#39;);
</code></pre>
<h3>Use with <a href="https://github.com/mishoo/UglifyJS2">UglifyJS</a></h3><p>Pass this module to the <a href="https://github.com/mishoo/UglifyJS2#keeping-comments-in-the-output"><code>comments</code> option</a>.</p>
<pre><code class="language-javascript">var result = UglifyJS.minify(&#39;file1.js&#39;, {
  output: {
    comments: saveLicense
  }
});
</code></pre>
<h3>Use with <a href="https://github.com/gruntjs/grunt-contrib-uglify">grunt-contrib-uglify</a></h3><p>Pass this module to the <a href="https://github.com/gruntjs/grunt-contrib-uglify#preservecomments"><code>preserveComments</code> option</a>.</p>
<pre><code class="language-javascript">grunt.initConfig({
  uglify: {
    my_target: {
      options: {
        preserveComments: saveLicense
      },    
      src: [&#39;src/app.js&#39;],
      dest: &#39;dest/app.min.js&#39; 
    }
  }
});
</code></pre>
<h2>How it works</h2><p><em>uglify-save-license</em> checks each <a href="http://lisperator.net/uglifyjs/ast#tokens">comment token</a> of a JavaScript file.
The comment will be regarded as a license statement and preserved after compression, if it meets at least one of the following requirements:</p>
<ol>
<li>The comment is in the <em>first</em> line of a file.</li>
<li><a href="./uglify-save-license.js#L7">The regexp for license statement</a> matches the string of the comment. It matches, for example, <code>MIT</code> and <code>Copyright</code>.</li>
<li>There is a comment at the <em>previous</em> line, and it matches 1. 2. or 3.</li>
</ol>
<h2>Examples</h2><h3>CLI tool example</h3><h4>Main script (<code>uglify-example.js</code>)</h4><pre><code class="language-javascript">#!/usr/bin/env node

var UglifyJS    = require(&#39;uglify-js&#39;),
    saveLicense = require(&#39;uglify-save-license&#39;);

var minified = UglifyJS.minify(process.argv[2], {
  output: {
    comments: saveLicense
  }
}).code;

console.log(minified);
</code></pre>
<h4>Target file</h4><pre><code class="language-javascript">// First line

// (c) 2014 John  &lt;- contains &#39;(c)&#39;
// The previous line is preserved

// This line won&#39;t be preserved.
(function(win, doc) {
  var str = &#39;Hello World! :&#39; + doc.title;

  // This line will not, too.
  console.log(str);
}(window, document));
</code></pre>
<h4>Command</h4><pre><code>node uglify-example.js &lt;target filename&gt;
</code></pre><h4>Output</h4><pre><code class="language-javascript">// First line
// (c) 2014 John  &lt;- contains &#39;(c)&#39;
// The previous line is preserved
!function(o,l){var n=&quot;Hello World! :&quot;+l.title;console.log(n)}(window,document);
</code></pre>
<h3><a href="http://gruntjs.com/getting-started#the-gruntfile">Gruntfile.coffee</a> example</h3><pre><code class="language-coffeescript">module.exports = (grunt) -&gt;

  grunt.loadNpmTasks &#39;grunt-contrib-uglify&#39;
  grunt.loadNpmTasks &#39;grunt-contrib-concat&#39;
  grunt.loadNpmTasks &#39;grunt-contrib-clean&#39;

  grunt.initConfig
    uglify:
      target:
        options:
          preserveComments: require &#39;uglify-save-license&#39;
        files: [
          expand: true
          flatten: true
          cwd: &#39;path/to/src&#39;
          src: [&#39;**/*.js&#39;]
          dest: &#39;tmp/&#39;
        ]

    concat:
      js:
        src: [&#39;tmp/*.js&#39;]
        dest: &#39;path/to/build/app.js&#39;

    clean:
      tmpdir: [&#39;tmp&#39;]

  grunt.registerTask &#39;default&#39; [&#39;uglify&#39;, &#39;concat&#39;, &#39;clean&#39;]
</code></pre>
<h2>Acknowledgements</h2><p><em>uglify-save-license</em> is inspired by <a href="https://github.com/kyo-ago/grunt-license-saver">grunt-license-saver</a> and I used it as reference.
Thanks, <a href="https://github.com/kyo-ago">kyo-ago</a>.</p>
<h2>License</h2><p>Copyright (c) 2013 - 2014 <a href="https://github.com/shinnn">Shinnosuke Watanabe</a></p>
<p>Licensed under <a href="./LICENSE">the MIT license</a>.</p>
